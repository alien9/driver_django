version: '3'
services:
  redis-server:
    image: redis
    container_name: "redis-server-vidasegura"

  driver-django:
    build:
      context: ./
    volumes:
      - ./static:/var/www/static
      - ./mapserver:/opt/app/mapserver
    depends_on:
      - redis-server
      - mapserver
    environment:
      - HOST_URL=${PROTOCOL}://${HOST_NAME}
      - HOSTNAME=${HOST_NAME}
      - TIMEZONE=${TIMEZONE}
      - DJANGO_ENV=development
      - DRIVER_DB_HOST=${DATABASE_HOST}
      - DRIVER_DB_NAME=${DATABASE_NAME}
      - DRIVER_DB_USER=${DATABASE_USERNAME}
      - DRIVER_DB_PASSWORD=${DATABASE_PASSWORD}
      - DRIVER_REDIS_HOST=redis-server-vidasegura
      - STATIC_ROOT=/var/www/static/
      - STATIC_URL=${PROTOCOL}://${HOST_NAME}/static/ 
      - OAUTH_CLIENT_ID=${CLIENTID}
      - OAUTH_CLIENT_SECRET=${CLIENT_SECRET}
      - DRIVER_ADMIN_PASSWORD=${DRIVER_ADMIN_PASSWORD}
      - CONTAINER_NAME=vidasegura
      - EMAIL_HOST=${EMAIL_HOST}
      - EMAIL_PORT=${EMAIL_PORT}
      - EMAIL_USE_TLS=${EMAIL_USE_TLS}
      - DEFAULT_FROM_EMAIL=${DEFAULT_FROM_EMAIL}
      - EMAIL_HOST_USER=${EMAIL_HOST_USER}
      - EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}
    container_name: driver-django-vidasegura
    image: alien9/driver-django:vidasegura
      
  driver-celery:
    volumes:
      - ./zip:/var/www/media
    depends_on:
      - redis-server
    environment:
      - HOST_URL=${PROTOCOL}://${HOST_NAME}
      - HOSTNAME=${HOST_NAME}
      - COUNTRY_CODE=${COUNTRY_CODE}
      - TIMEZONE=${TIMEZONE}
      - DJANGO_ENV=production
      - DRIVER_DB_HOST=${DATABASE_HOST}
      - DRIVER_DB_NAME=${DATABASE_NAME}
      - DRIVER_DB_USER=${DATABASE_USERNAME}
      - DRIVER_DB_PASSWORD=${DATABASE_PASSWORD}
      - DRIVER_REDIS_HOST=redis-server-vidasegura
      - STATIC_ROOT=/var/www/static/
      - STATIC_URL=${PROTOCOL}://${HOST_NAME}/static/ 
      - OAUTH_CLIENT_ID=${CLIENTID}
      - OAUTH_CLIENT_SECRET=${CLIENT_SECRET}
    entrypoint: ["celery", "-A", "driver", "worker", "--queue=taskworker", "--loglevel=info", "--concurrency=4"]
    container_name: driver-celery-vidasegura
    image: alien9/driver-django:vidasegura

       
  mapserver:
    container_name: mapserver-vidasegura
    volumes:
      - ./mapserver/:/etc/mapserver
    image: geodata/mapserver

  geoserver:
    container_name: driver-geoserver-vidasegura
    volumes:
      - /home/tiago/data_dir:/opt/data_dir
    environment:
      - GEOSERVER_DATA_DIR=/opt/data_dir
      - GEOSERVER_ADMIN_USER=admin
      - GEOSERVER_ADMIN_PASSWORD=geoserver
    image: kartoza/geoserver